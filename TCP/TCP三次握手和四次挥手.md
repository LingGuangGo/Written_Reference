## TCP的三次握手和四次挥手

- 连接: 3次握手; 
  - **第三次握手**:  确认了TCP数据的最大消息长度MSS;maximum segment size
  - 确保消息不会被IP路由分割
- 断开: 4次握手
  - 断开的时候, 客户端要等待2MSL才关闭

1. TCP为什么需要第三次握手?

   - 为了防止已失效的连接请求报文段又突然传送给服务器，从而产生了错误
   - 如果没有三次握手，那么服务器发送确认后，连接就建立了，而此时客户端没有发送建立连接的请求报文段，于是不理会服务器的确认，也不会给服务器发送数据，而服务器却一直等待客户端发送数据，因此服务器的许多资源就浪费了，采用三次握手的方式就可以防止这种事情发生。

2. TCP第4次挥手为何要等待2MSL才关闭？

   - MSL(Maximum Segment Lifetime)报文最大生存时间

     - 任何报文在网络上存活的最大时间，一旦超过该时间，报文就会被丢弃。
     - TIME_WAIT = 2MSL也就是指的2倍MSL的时间。

   - 保证客户端最后一次挥手的报文能够到达服务器，若第4次挥手的报文段丢失了，服务器就会超时重传第3次挥手的报文段, client是保持TIME_WAIT

     ![TCP_MSL.png](https://github.com/quronghui/Embedded-written-reference/blob/master/TCP/photo/TCP_MSL.png)

